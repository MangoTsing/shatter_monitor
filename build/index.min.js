var shatter=function(t){"use strict";var o,e;!function(t){t.JAVASCRIPT_ERROR="JAVASCRIPT_ERROR",t.BUSINESS_ERROR="BUSINESS_ERROR",t.LOG_ERROR="LOG_ERROR",t.FETCH_ERROR="HTTP_ERROR",t.RESOURCE_ERROR="RESOURCE_ERROR",t.PROMISE_ERROR="PROMISE_ERROR",t.VUE_ERROR="VUE_ERROR"}(o||(o={})),function(t){t.jsError="JS_ERROR",t.sourceError="SOURCE_ERROR",t.promiseError="UNHANDLEDREJECTION",t.consoleError="CONSOLE_ERROR",t.ajaxError="AJAX_ERROR",t.fetchError="FETCH_ERROR",t.VueError="VueError"}(e||(e={}));const r=function(t,r){if(!r.blockTry){const t=EventTarget.prototype.addEventListener;EventTarget.prototype.addEventListener=function(o,e,r){return t.call(this,o,(function(){try{return e.apply(this,arguments)}catch(t){throw t}}),r)}}if(!r.blockError){const r=window.onerror||null;window.onerror=(n,s,i,a,c)=>{t.report({name:e.jsError,msg:n,url:s,line:i,col:a,type:o.JAVASCRIPT_ERROR}),r&&r(n,s,i,a,c)}}if(r.blockSource||window.addEventListener("error",r=>{if(!r)return;const n=r.target||r.srcElement;if(!(n instanceof HTMLScriptElement||n instanceof HTMLLinkElement||n instanceof HTMLImageElement))return!1;const s=n.src||n.href;t.report({name:e.sourceError,url:s,type:o.RESOURCE_ERROR})},!0),r.blockPromise||window.addEventListener("unhandledrejection",r=>{if(!r.reason||!r.reason.stack||!r.reason.stack.includes("\n"))return void t.report({name:e.promiseError,type:o.PROMISE_ERROR,msg:r.reason&&r.reason.stack||r.reason||""});const n=r.reason.stack.split("\n")[1].split("at ")[1],s=n.split(":"),i=s[s.length-2],a=s[s.length-1],c=n&&n.slice(0,-i.length-a.length-2),p=r.reason.message;t.report({name:e.promiseError,msg:p,url:c,line:i,col:a,type:o.PROMISE_ERROR})},!0),!r.blockConsole){const r=window.console.error;window.console.error=(n=r,(...r)=>{r.forEach(r=>{if(n=r,Object.prototype.toString.call(n).indexOf("Error")>-1){const n=r.stack.split("\n")[1].split("at ")[1],s=n.split(":"),i=s[s.length-2],a=s[s.length-2],c=n.split("(")[1]&&n.split("(")[1].slice(0,-i.length-a.length-2)||"anonymousFunction";t.report({name:e.consoleError,msg:r.stack,url:c,line:i,col:a,type:o.LOG_ERROR})}else t.report({name:e.consoleError,msg:r,type:o.LOG_ERROR});var n}),n.apply(console,r)})}var n};class n{constructor(t){this.options=t}beforeSendData(t){if(!this.options.beforeSendData)return!0;try{return this.options.beforeSendData(t)}catch(t){throw t}}}function s(t){const o=t.substr&&t.substr(0,5);return o?"https"===o?"https":"http:"===o?"http":"other":"unknown"}class i{constructor(t){this.sendType="img",this.options=t,this._init()}_init(){const t=this.options,{blockConsole:i,blockPromise:a,blockError:c,blockSource:p,blockXhr:l,blockFetch:u,blockTry:R,blockHttpRequest:h,onlyHttpRequest:E}=t;this.hooks=new n(t),window.navigator&&window.navigator.sendBeacon&&!t.onlyImg&&(this.sendType="beacon"),E||r(this,{blockConsole:i,blockPromise:a,blockError:c,blockSource:p,blockTry:R}),h||(l||function(t){if(!window.XMLHttpRequest)return;const o=window.XMLHttpRequest,e=o.prototype.send,r=o.prototype.open,n=function(o,e,r){o&&o.currentTarget&&200!==o.currentTarget.status&&t&&t(o,e,r)};o.prototype.open=function(){const t=arguments;return this._openArgs=t,r.apply(this,t)},o.prototype.send=function(){const t=arguments;if(this.addEventListener)this.addEventListener("error",(function(o){n(o,t,this._openArgs)})),this.addEventListener("load",(function(o){n(o,t,this._openArgs)})),this.addEventListener("abort",(function(o){n(o,t,this._openArgs)}));else{const o=this.onreadystatechange;this.onreadystatechange=function(e){4===this.readyState&&n(e,t,this._openArgs),o&&o.apply(this,t)}}return e.apply(this,t)}}((t,r,n)=>{const i=t.currentTarget,a=i.responseURL;this.report({name:e.ajaxError,url:a,type:o.FETCH_ERROR,request:{method:n[0],httpType:s(a),data:r&&r[0]||""},response:{status:i.status,data:i.statusText}})}),u||function(t,o){if(!window.fetch)return;const e=window.fetch;window.fetch=function(){const r=arguments;return e.apply(this,r).then(o=>(o.ok||t&&t(o,r),o)).catch(t=>{throw o&&o(t.toString(),r),t})}}((t,r)=>{t.text().then(n=>{const i=t.url||r[0];this.report({name:e.fetchError,url:i,msg:t.statusText,type:o.FETCH_ERROR,request:{httpType:s(i),method:r[1].method,data:r[1].body||""},response:{status:t.status,data:n||t.statusText}})})},(t,r)=>{const n=s(r[0]);this.report({name:e.fetchError,msg:t,url:r[0],type:o.FETCH_ERROR,request:{httpType:n,data:r[1].body,method:r[1].method}})}))}report(t){const{dsn:o,appkey:e}=this.options;Object.assign(t,{_t:(new Date).getTime(),appkey:e});if(!this.hooks.beforeSendData(t))return!1;const r=(n=t,Object.entries(n).reduce((t,[o,e],r)=>("object"==typeof e&&(e=JSON.stringify(e)),0!==r&&(t+="&"),t+=`${o}=${encodeURIComponent(e)}`),""));var n,s;this.options.debug?console.log(`log to : ${o}?${r}`):"img"===this.sendType?(s=`${o}?${r}`,(new Image).src=s):"beacon"===this.sendType&&function(t,o="formData"){if("formData"!==o)return;const e=new FormData;for(const o in t){if("dsn"===o)continue;let r=t[o];"object"==typeof r&&(r=JSON.stringify(r)),e.append(o,r)}window.navigator.sendBeacon(t.dsn,e)}(Object.assign(t,{dsn:o}))}}class a{constructor(){console.log("performance")}init(){console.log("performance init")}}class c{constructor(){console.log("behavior")}init(){console.log("behavior init")}}function p(t,r,n){const s=function(t){if(t.$root===t)return"root";const o=t._isVue?t.$options&&t.$options.name||t.$options&&t.$options._componentTag:t.name;return(o?"component <"+o+">":"anonymous component")+(t._isVue&&t.$options&&t.$options.__file?" at "+(t.$options&&t.$options.__file):"")}(r),i=r.$options&&r.$options.propsData;return{type:o.VUE_ERROR,msg:`${t.message}(${n})`,url:"undefined"==typeof document||null==document.location?"":document.location.href,componentName:s,propsData:i||"",name:e.VueError,stack:t.stack||[]}}class l{constructor(t){const{usage:o}=t,e=l.shatterSupport,r=[];"all"===o?r.push(...Object.keys(e)):Array.isArray(o)?r.push(...o):"string"==typeof o?r.push(o):r.push("ErrorForShatter"),r.forEach(o=>{new e[o](t)})}}return l.shatterSupport={ErrorForShatter:i,PerformanceForShatter:a,BehaviorForShatter:c},t.BehaviorForShatter=c,t.ErrorForShatter=i,t.PerformanceForShatter=a,t.ShatterErrorVue=class{static install(t,o){const e=new i(o);t.config.errorHandler=function(t,o,r){const n=p.apply(null,[t,o,r]);e.report(n)}}},t.ShatterInit=l,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
