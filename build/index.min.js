var shatter=function(t){"use strict";var e,o;!function(t){t.JAVASCRIPT_ERROR="JAVASCRIPT_ERROR",t.BUSINESS_ERROR="BUSINESS_ERROR",t.LOG_ERROR="LOG_ERROR",t.FETCH_ERROR="HTTP_ERROR",t.RESOURCE_ERROR="RESOURCE_ERROR",t.PROMISE_ERROR="PROMISE_ERROR",t.VUE_ERROR="VUE_ERROR"}(e||(e={})),function(t){t.jsError="JS_ERROR",t.sourceError="SOURCE_ERROR",t.promiseError="UNHANDLEDREJECTION",t.consoleError="CONSOLE_ERROR",t.ajaxError="AJAX_ERROR",t.fetchError="FETCH_ERROR",t.VueError="VueError"}(o||(o={}));const n=function(t,n){if(!n.blockTry){const t=EventTarget.prototype.addEventListener,e=EventTarget.prototype.removeEventListener,o=[];EventTarget.prototype.addEventListener=function(e,n,r){const s=function(){try{return n.apply(this,arguments)}catch(t){throw t}};return o.push({origin:n,wrap:s}),t.call(this,e,s,r)},EventTarget.prototype.removeEventListener=function(t,n,r){let s;return o.some(t=>t.origin===n&&(s=t.wrap,!0))?e.call(this,t,s,r):e.call(this,t,n,r)}}if(!n.blockError){const n=window.onerror||null;window.onerror=(r,s,i,a,c)=>{t.report({name:o.jsError,msg:r,url:s,line:i,col:a,type:e.JAVASCRIPT_ERROR}),n&&n(r,s,i,a,c)}}if(n.blockSource||window.addEventListener("error",n=>{if(!n)return;const r=n.target||n.srcElement;if(!(r instanceof HTMLScriptElement||r instanceof HTMLLinkElement||r instanceof HTMLImageElement))return!1;const s=r.src||r.href;t.report({name:o.sourceError,url:s,type:e.RESOURCE_ERROR})},!0),n.blockPromise||window.addEventListener("unhandledrejection",n=>{if(!n.reason||!n.reason.stack||!n.reason.stack.includes("\n"))return void t.report({name:o.promiseError,type:e.PROMISE_ERROR,msg:n.reason&&n.reason.stack||n.reason||""});const r=n.reason.stack.split("\n")[1].split("at ")[1],s=r.split(":"),i=s[s.length-2],a=s[s.length-1],c=r&&r.slice(0,-i.length-a.length-2),p=n.reason.message;t.report({name:o.promiseError,msg:p,url:c,line:i,col:a,type:e.PROMISE_ERROR})},!0),!n.blockConsole){const n=window.console.error;window.console.error=(r=n,(...n)=>{n.forEach(n=>{if(r=n,Object.prototype.toString.call(r).indexOf("Error")>-1){let r;r=n.stack&&n.stack.split("\n")[1]?n.stack&&n.stack.split("\n")[1].split("at ")[1]:n.stack;const s=r.split(":"),i=s[s.length-2],a=s[s.length-1],c=r.split("(")[1]&&r.split("(")[1].slice(0,-i.length-a.length-2)||"anonymousFunction";t.report({name:o.consoleError,msg:n.stack,url:c,line:i,col:a,type:e.LOG_ERROR})}else t.report({name:o.consoleError,msg:n,type:e.LOG_ERROR});var r}),r.apply(console,n)})}var r};class r{constructor(t){this.options=t}beforeSendData(t){if(!this.options.beforeSendData)return!0;try{return this.options.beforeSendData(t)}catch(t){throw t}}}function s(t){const e=t.substr&&t.substr(0,5);return e?"https"===e?"https":"http:"===e?"http":"other":"unknown"}class i{constructor(t){this.sendType="img",this.options=t,this._init()}_init(){const t=this.options,{blockConsole:i,blockPromise:a,blockError:c,blockSource:p,blockXhr:l,blockFetch:u,blockTry:h,blockHttpRequest:R,onlyHttpRequest:E}=t;this.hooks=new r(t),window.navigator&&window.navigator.sendBeacon&&!t.onlyImg&&(this.sendType="beacon"),E||n(this,{blockConsole:i,blockPromise:a,blockError:c,blockSource:p,blockTry:h}),R||(l||function(t){if(!window.XMLHttpRequest)return;const e=window.XMLHttpRequest,o=e.prototype.send,n=e.prototype.open,r=function(e,o,n,r){e&&e.currentTarget&&200!==e.currentTarget.status&&t&&t(e,o,n,r)};e.prototype.open=function(){const t=arguments;return this._openArgs=t,this._openTime=(new Date).getTime(),n.apply(this,t)},e.prototype.send=function(){const t=arguments;if(this.addEventListener)this.addEventListener("error",(function(e){r(e,t,this._openArgs,this._openTime)})),this.addEventListener("load",(function(e){r(e,t,this._openArgs,this._openTime)})),this.addEventListener("abort",(function(e){r(e,t,this._openArgs,this._openTime)}));else{const e=this.onreadystatechange;this.onreadystatechange=function(o){4===this.readyState&&r(o,t,this._openArgs,this._openTime),e&&e.apply(this,t)}}return o.apply(this,t)}}((t,n,r,i)=>{const a=t.currentTarget,c=a.responseURL,p=(new Date).getTime()-i;this.report({name:o.ajaxError,url:c,type:e.FETCH_ERROR,fetchTimeline:p,request:{method:r[0],httpType:s(c),data:n&&n[0]||""},response:{status:a.status,data:a.statusText}})}),u||function(t,e){if(!window.fetch)return;const o=window.fetch;window.fetch=function(){const n=arguments,r=(new Date).getTime();return o.apply(this,n).then(e=>(e.ok||t&&t(e,n,r),e)).catch(t=>{throw e&&e(t.toString(),n,r),t})}}((t,n,r)=>{t.text().then(i=>{const a=t.url||n[0],c=(new Date).getTime()-r;this.report({name:o.fetchError,url:a,msg:t.statusText,type:e.FETCH_ERROR,fetchTimeline:c,request:{httpType:s(a),method:n[1].method,data:n[1].body||""},response:{status:t.status,data:i||t.statusText}})})},(t,n,r)=>{const i=s(n[0]),a=(new Date).getTime()-r;this.report({name:o.fetchError,msg:t,url:n[0],fetchTimeline:a,type:e.FETCH_ERROR,request:{httpType:i,data:n[1].body,method:n[1].method}})}))}report(t){const{dsn:e,appkey:o}=this.options;Object.assign(t,{_t:(new Date).getTime(),appkey:o});if(!this.hooks.beforeSendData(t))return!1;const n=(r=t,Object.entries(r).reduce((t,[e,o],n)=>("object"==typeof o&&(o=JSON.stringify(o)),0!==n&&(t+="&"),t+=`${e}=${encodeURIComponent(o)}`),""));var r,s;this.options.debug?console.log(`log to : ${e}?${n}`):"img"===this.sendType?(s=`${e}?${n}`,(new Image).src=s):"beacon"===this.sendType&&function(t,e="formData"){if("formData"!==e)return;const o=new FormData;for(const e in t){if("dsn"===e)continue;let n=t[e];"object"==typeof n&&(n=JSON.stringify(n)),o.append(e,n)}window.navigator.sendBeacon(t.dsn,o)}(Object.assign(t,{dsn:e}))}}class a{constructor(){console.log("performance")}init(){console.log("performance init")}}class c{constructor(){console.log("behavior")}init(){console.log("behavior init")}}function p(t,n,r){const s=function(t){if(t.$root===t)return"root";const e=t._isVue?t.$options&&t.$options.name||t.$options&&t.$options._componentTag:t.name;return(e?"component <"+e+">":"anonymous component")+(t._isVue&&t.$options&&t.$options.__file?" at "+(t.$options&&t.$options.__file):"")}(n),i=n.$options&&n.$options.propsData;return{type:e.VUE_ERROR,msg:`${t.message}(${r})`,url:"undefined"==typeof document||null==document.location?"":document.location.href,componentName:s,propsData:i||"",name:o.VueError,stack:t.stack||[]}}class l{constructor(t){const{usage:e}=t,o=l.shatterSupport,n=[];"all"===e?n.push(...Object.keys(o)):Array.isArray(e)?n.push(...e):"string"==typeof e?n.push(e):n.push("ErrorForShatter"),n.forEach(e=>{new o[e](t)})}}return l.shatterSupport={ErrorForShatter:i,PerformanceForShatter:a,BehaviorForShatter:c},t.BehaviorForShatter=c,t.ErrorForShatter=i,t.PerformanceForShatter=a,t.ShatterErrorVue=class{static install(t,e){const o=new i(e);t.config.errorHandler=function(t,e,n){const r=p.apply(null,[t,e,n]);o.report(r)}}},t.ShatterInit=l,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
