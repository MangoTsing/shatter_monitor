var shatter=function(t){"use strict";var e;!function(t){t.JAVASCRIPT_ERROR="JAVASCRIPT_ERROR",t.BUSINESS_ERROR="BUSINESS_ERROR",t.LOG_ERROR="LOG_ERROR",t.FETCH_ERROR="HTTP_ERROR",t.RESOURCE_ERROR="RESOURCE_ERROR",t.PROMISE_ERROR="PROMISE_ERROR"}(e||(e={}));class n{constructor(t){this.options=t}beforeSendData(t){if(!this.options.beforeSendData)return!0;try{return this.options.beforeSendData(t)}catch(t){throw t}}}return t.init=class{constructor(t){this.sendType="img",this.options=t,this.hooks=new n(t),window.navigator&&window.navigator.sendBeacon&&(this.sendType="beacon"),function(t){const n=EventTarget.prototype.addEventListener;EventTarget.prototype.addEventListener=function(t,e,s){return n.call(this,t,(function(){try{return e.apply(this,arguments)}catch(t){throw t}}),s)};const s=window.onerror||null;window.onerror=(n,o,r,i,a)=>{t.log({name:"jserror",msg:n,url:o,line:r,col:i,type:e.JAVASCRIPT_ERROR}),s&&s(n,o,r,i,a)},window.addEventListener("error",n=>{if(!n)return;const s=n.target||n.srcElement;if(!(s instanceof HTMLScriptElement||s instanceof HTMLLinkElement||s instanceof HTMLImageElement))return!1;const o=s.src||s.href;t.log({name:"sourceError",url:o,type:e.RESOURCE_ERROR})},!0),window.addEventListener("unhandledrejection",n=>{if(!n.reason||!n.reason.stack)return void t.log({name:"unhandledrejection",type:e.PROMISE_ERROR});const s=n.reason.stack.split("\n")[1].split("at ")[1],o=s.split(":"),r=o[o.length-2],i=o[o.length-1],a=s.slice(0,-r.length-i.length-2),c=n.reason.message;t.log({name:"unhandledrejection",msg:c,url:a,line:r,col:i,type:e.PROMISE_ERROR})},!0)}(this),function(t){if(!window.XMLHttpRequest)return;const e=window.XMLHttpRequest,n=e.prototype.send,s=function(e){e&&e.currentTarget&&200!==e.currentTarget.status&&t&&t(e)};e.prototype.send=function(){if(this.addEventListener)this.addEventListener("error",s),this.addEventListener("load",s),this.addEventListener("abort",s);else{const t=this.onreadystatechange;this.onreadystatechange=function(e){4===this.readyState&&s(e),t&&t.apply(this,arguments)}}return n.apply(this,arguments)}}(t=>{const n=t.currentTarget;this.log({name:"xhrError",url:n.responseURL,type:e.FETCH_ERROR,response:{status:n.status,data:n.statusText}})}),function(t,e){if(!window.fetch)return;const n=window.fetch;window.fetch=function(){const s=arguments;return n.apply(this,arguments).then(e=>(e.ok||t&&t(e),e)).catch(t=>{throw e&&e(t.toString(),s),t})}}(t=>{this.log({name:"fetchError",url:t.url,msg:t.statusText,type:e.FETCH_ERROR,response:{status:t.status,data:t.statusText}})},(t,n)=>{const s="https"===n[0].substr(0,5)?"https":"other";this.log({name:"fetchError",msg:t,type:e.FETCH_ERROR,request:{httpType:s,data:n[1].body,method:n[1].method,url:n[0]}})})}log(t){const{dsn:e,appkey:n}=this.options;Object.assign(t,{_t:(new Date).getTime(),appkey:n});if(!this.hooks.beforeSendData())return!1;const s=(o=t,Object.entries(o).reduce((t,[e,n],s)=>("object"==typeof n&&(n=JSON.stringify(n)),0!==s&&(t+="&"),t+=`${e}=${n}`),""));var o,r;this.options.debug?console.log(`log to : ${e}?${s}`):"img"===this.sendType?(r=`${e}?${s}`,(new Image).src=r):"beacon"===this.sendType&&function(t,e="formData"){if("formData"!==e)return;const n=new FormData;for(const e in t){if("dsn"===e)continue;let s=t[e];"object"==typeof s&&(s=JSON.stringify(s)),n.append(e,s)}window.navigator.sendBeacon(t.dsn,n)}(Object.assign(t,{dsn:e}))}},Object.defineProperty(t,"__esModule",{value:!0}),t}({});
