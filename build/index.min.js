var shatter=function(t){"use strict";var e;!function(t){t.JAVASCRIPT_ERROR="JAVASCRIPT_ERROR",t.BUSINESS_ERROR="BUSINESS_ERROR",t.LOG_ERROR="LOG_ERROR",t.FETCH_ERROR="HTTP_ERROR",t.RESOURCE_ERROR="RESOURCE_ERROR",t.PROMISE_ERROR="PROMISE_ERROR"}(e||(e={}));class n{constructor(t){this.options=t}beforeSendData(t){if(!this.options.beforeSendData)return!0;try{return this.options.beforeSendData(t)}catch(t){throw t}}}return t.Shatter=class{constructor(t){this.sendType="img",this.options=t,this._init()}_init(){this.hooks=new n(this.options),window.navigator&&window.navigator.sendBeacon&&(this.sendType="beacon"),function(t){const n=EventTarget.prototype.addEventListener;EventTarget.prototype.addEventListener=function(t,e,r){return n.call(this,t,(function(){try{return e.apply(this,arguments)}catch(t){throw t}}),r)};const r=window.onerror||null;window.onerror=(n,s,o,i,a)=>{t.report({name:"jserror",msg:n,url:s,line:o,col:i,type:e.JAVASCRIPT_ERROR}),r&&r(n,s,o,i,a)},window.addEventListener("error",n=>{if(!n)return;const r=n.target||n.srcElement;if(!(r instanceof HTMLScriptElement||r instanceof HTMLLinkElement||r instanceof HTMLImageElement))return!1;const s=r.src||r.href;t.report({name:"sourceError",url:s,type:e.RESOURCE_ERROR})},!0),window.addEventListener("unhandledrejection",n=>{if(!n.reason||!n.reason.stack)return void t.report({name:"unhandledrejection",type:e.PROMISE_ERROR});const r=n.reason.stack.split("\n")[1].split("at ")[1],s=r.split(":"),o=s[s.length-2],i=s[s.length-1],a=r.slice(0,-o.length-i.length-2),c=n.reason.message;t.report({name:"unhandledrejection",msg:c,url:a,line:o,col:i,type:e.PROMISE_ERROR})},!0)}(this),function(t){if(!window.XMLHttpRequest)return;const e=window.XMLHttpRequest,n=e.prototype.send,r=function(e){e&&e.currentTarget&&200!==e.currentTarget.status&&t&&t(e)};e.prototype.send=function(){if(this.addEventListener)this.addEventListener("error",r),this.addEventListener("load",r),this.addEventListener("abort",r);else{const t=this.onreadystatechange;this.onreadystatechange=function(e){4===this.readyState&&r(e),t&&t.apply(this,arguments)}}return n.apply(this,arguments)}}(t=>{const n=t.currentTarget;this.report({name:"xhrError",url:n.responseURL,type:e.FETCH_ERROR,response:{status:n.status,data:n.statusText}})}),function(t,e){if(!window.fetch)return;const n=window.fetch;window.fetch=function(){const r=arguments;return n.apply(this,arguments).then(e=>(e.ok||t&&t(e),e)).catch(t=>{throw e&&e(t.toString(),r),t})}}(t=>{this.report({name:"fetchError",url:t.url,msg:t.statusText,type:e.FETCH_ERROR,response:{status:t.status,data:t.statusText}})},(t,n)=>{const r="https"===n[0].substr(0,5)?"https":"other";this.report({name:"fetchError",msg:t,type:e.FETCH_ERROR,request:{httpType:r,data:n[1].body,method:n[1].method,url:n[0]}})})}report(t){const{dsn:e,appkey:n}=this.options;Object.assign(t,{_t:(new Date).getTime(),appkey:n});if(!this.hooks.beforeSendData())return!1;const r=(s=t,Object.entries(s).reduce((t,[e,n],r)=>("object"==typeof n&&(n=JSON.stringify(n)),0!==r&&(t+="&"),t+=`${e}=${n}`),""));var s,o;this.options.debug?console.log(`log to : ${e}?${r}`):"img"===this.sendType?(o=`${e}?${r}`,(new Image).src=o):"beacon"===this.sendType&&function(t,e="formData"){if("formData"!==e)return;const n=new FormData;for(const e in t){if("dsn"===e)continue;let r=t[e];"object"==typeof r&&(r=JSON.stringify(r)),n.append(e,r)}window.navigator.sendBeacon(t.dsn,n)}(Object.assign(t,{dsn:e}))}},Object.defineProperty(t,"__esModule",{value:!0}),t}({});
